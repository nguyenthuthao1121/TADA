@page
@model BookDetailUserModel
@using TADA.Model.Entity
@{
    ViewData["Title"] = Model.Book.Name;
    ViewBag.Name = Model.Username;
}
@{
    var oldPrice = Model.Book.Price.ToString("N0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN")).Replace(',', '.'); 
    var newPrice = (Model.Book.Price * (100 - Model.Book.Promotion) / 100).ToString("N0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN")).Replace(',', '.');
    var dimension = Model.Book.Length + " x " + Model.Book.Width + " cm";
    var descriptionText = "";
    var filePath = Model.Book.Description;
    if (System.IO.File.Exists(filePath))
    {
        using (StreamReader sr = new StreamReader(filePath, System.Text.Encoding.Default))
        {
            descriptionText = sr.ReadToEnd();
            descriptionText = descriptionText.Replace("\n", "<br>");
            sr.Close();
        }
    }
    var imgPath = Model.Book.Image + "/thien_su_nha_ben_5_bia.jpg";
    var numberOfReview = Model.Reviews.Count;
    //var averageRating = Model.Reviews.Average(decimal p, )
}
<div class="container-fluid">
    <div class="row">
        <div class="col-1"></div>
        <div class="col-10">
            <div class="row bg-white px-3 py-4 mt-3 rounded">
                <div class="col-4">
                    <div class="bookImage" style="border: 0.5px solid #CCCCCC;">
                        <img src="@Url.Content(imgPath)" alt="Book image" style="width: 100%; border: 0.5px">
                    </div>
                    <div class="row mt-3">
                        <div class="col">
                            <button type="button" class="shopping-cart"><i class="fas fa-shopping-cart" style="font-size: 1rem; margin-right: 4px; font-weight: 700; color: var(--primary-color)"></i>Thêm vào giỏ hàng</button>
                        </div>
                        <div class="col">
                            <button type="button" class="btn btn-primary" style="width: 100%; text-transform: none; padding: 8px">Mua ngay</button>
                        </div>
                    </div>
                </div>
                <div class="book-essential-detail col-8 px-5">
                    <h4 class="fw-bold" style="line-height: 2rem">@Model.Book.Name</h4>
                    <div class="row mt-4">
                        <div class="provider col-6">
                            <span>Nhà cung cấp:</span>
                            <span style="color: var(--primary-color)">Phụ Nữ</span>
                        </div>
                        <div class="author col-6">
                            <span>Tác giả:</span>
                            <span style="font-weight: bold;">@Model.Book.Author</span>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="publisher col-6">
                            <span>Nhà xuất bản:</span>
                            <span style="font-weight: bold;">@Model.Book.Publisher</span>
                        </div>
                        <div class="cover col-6">
                            <span>Hình thức bìa:</span>
                            <span style="font-weight: bold;">@Model.Book.Cover</span>
                        </div>
                    </div>
                    <div class="row" style="margin-top: 4rem">
                        <div class="rating-star">
                            <span class="fas fa-star"></span>
                            <span class="fas fa-star"></span>
                            <span class="fas fa-star"></span>
                            <span class="fas fa-star"></span>
                            <span class="fas fa-star"></span>
                            <span class="ms-1" style="color: var(--primary-color)">(0 đánh giá)</span>
                        </div>
                    </div>
                    <div class="book-price mt-2 d-flex align-items-center">
                        <span class="new-price">@newPrice đ</span>
                        <span class="old-price">@oldPrice đ</span>
                        <span class="sale-percent">@(-Model.Book.Promotion)%</span>
                    </div>
                    <div class="quantity mt-3 d-flex" style="align-items: baseline">
                        <span style="font-weight: bold; margin-right: 2rem">Số lượng:</span>
                        <span class="form-group d-flex">
                            <button class="input-group-text" style="border-radius: 8px 0 0 8px; border-right-style: none;" type="button"><i class="fas fa-minus"></i></button>
                            <input class="form-control" type="text" value="1">
                            <button class="input-group-text" style="border-radius: 0 8px 8px 0; border-left-style: none;" type="button"><i class="fas fa-plus"></i></button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="row bg-white mt-3 rounded px-3 py-4">
                <div class="col-12">
                    <h5 style="font-weight: bold">Thông tin sách</h5>
                    <div class="book-detail">
                        <table>
                            <tbody>
                                <tr>
                                    <td>Tên nhà cung cấp</td>
                                    <td>Phụ Nữ</td>
                                </tr>
                                <tr>
                                    <td>Tác giả</td>
                                    <td>@Model.Book.Author</td>
                                </tr>
                                <tr>
                                    <td>Nhà xuất bản</td>
                                    <td>@Model.Book.Publisher</td>
                                </tr>
                                <tr>
                                    <td>Năm xuất bản</td>
                                    <td>@Model.Book.PublicationYear</td>
                                </tr>
                                <tr>
                                    <td>Thể loại</td>
                                    <td>@Model.Book.Genre</td>
                                </tr>
                                <tr>
                                    <td>Trọng lượng (gr)</td>
                                    <td>@Model.Book.Weight</td>
                                </tr>
                                <tr>
                                    <td>Kích thước bao bì</td>
                                    <td>@dimension</td>
                                </tr>
                                <tr>
                                    <td>Số trang</td>
                                    <td>@Model.Book.Pages</td>
                                </tr>
                                <tr>
                                    <td>Hình thức</td>
                                    <td>@Model.Book.Cover</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-12 book-desciption mt-3">
                    <p style="text-align: justify">
                        @Html.Raw(descriptionText)
                    </p>
                </div>
                <div class="col-12 mt-3 d-flex justify-content-center">
                    <button type="button" class="read-more" style="width: 20%">Xem thêm</button>
                </div>
            </div>
            <div class="row bg-white my-3 px-4 py-4 rounded">
                <h5 style="font-weight: bold">Đánh giá sản phẩm</h5>
                <div class="col-12 px-3 d-flex">
                    <div class="rating-detail">
                        <div class="rating-number" style="text-align: center;">
                            <span style="font-weight: bold; font-size: 4rem">0</span>
                            <span style="font-weight: bold; font-size: 3rem">/5</span>
                        </div>
                        <div class="rating-star" style="margin-top: -0.8rem; text-align: center;">
                            <span class="fas fa-star"></span>
                            <span class="fas fa-star"></span>
                            <span class="fas fa-star"></span>
                            <span class="fas fa-star"></span>
                            <span class="fas fa-star"></span>
                            <div class="mt-1" style="color: var(--primary-color)">((@Model.Reviews.Count) đánh giá)</div>
                        </div>
                    </div>
                    <div class="rating-bar">
                        <div class="rating-level">
                            <label for="review-rating-bar">5<i class="fas fa-star"></i></label>
                            <progress id="review-rating-bar" max="100" value="80"></progress>
                            <span class="ms-2">80%</span>
                        </div>
                        <div class="rating-level">
                            <label for="review-rating-bar">4<i class="fas fa-star"></i></label>
                            <progress id="review-rating-bar" max="100" value="0"></progress>
                            <span class="ms-2">0%</span>
                        </div>
                        <div class="rating-level">
                            <label for="review-rating-bar">3<i class="fas fa-star"></i></label>
                            <progress id="review-rating-bar" max="100" value="0"></progress>
                            <span class="ms-2">0%</span>
                        </div>
                        <div class="rating-level">
                            <label for="review-rating-bar">2<i class="fas fa-star"></i></label>
                            <progress id="review-rating-bar" max="100" value="0"></progress>
                            <span class="ms-2">0%</span>
                        </div>
                        <div class="rating-level">
                            <label for="review-rating-bar">1<i class="fas fa-star"></i></label>
                            <progress id="review-rating-bar" max="100" value="0"></progress>
                            <span class="ms-2">0%</span>
                        </div>
                    </div>
                </div>
                @{
                    foreach(var review in Model.Reviews)
                    {
                        <div class="col-12 d-flex rounded px-3 py-3 align-items-center mt-4" style="background-color: rgba(30, 144, 255, 0.1)">
                            <div class="user-image">TT</div>
                            <div class="user-information-review ms-3">
                                <div class="user-name" style="font-size: 1.2rem">@review.CustomerName</div>
                                <div class="date-review">@review.DateReview.ToShortDateString()</div>
                            </div>
                            <div>
                                <div class="rating-star" style="font-size: 0.9rem; height: 1.8rem">
                                    <span class="fas fa-star" style="color: #F6A500; font-weight: bold;"></span>
                                    <span class="fas fa-star"></span>
                                    <span class="fas fa-star"></span>
                                    <span class="fas fa-star"></span>
                                    <span class="fas fa-star"></span>
                                </div>
                                <div class="user-comment">
                                    @review.Comment
                                </div>
                            </div>
                        </div>

                    }
                }
                @*<div class="col-12 d-flex rounded px-3 py-3 align-items-center mt-4" style="background-color: rgba(30, 144, 255, 0.1)">
                    <div class="user-image">TT</div>
                    <div class="user-information-review ms-3">
                        <div class="user-name" style="font-size: 1.2rem">Thu Thảo</div>
                        <div class="date-review">10/02/2023</div>
                    </div>
                    <div>
                        <div class="rating-star" style="font-size: 0.9rem; height: 1.8rem">
                            <span class="fas fa-star" style="color: #F6A500; font-weight: bold;"></span>
                            <span class="fas fa-star"></span>
                            <span class="fas fa-star"></span>
                            <span class="fas fa-star"></span>
                            <span class="fas fa-star"></span>
                        </div>
                        <div class="user-comment">
                            Truyện không hợp với mình. Cho 1 sao.
                        </div>
                    </div>
                </div>
                <div class="col-12 d-flex rounded px-3 py-3 align-items-center mt-2" style="background-color: rgba(30, 144, 255, 0.1)">
                    <div class="user-image">QT</div>
                    <div class="user-information-review ms-3">
                        <div class="user-name" style="font-size: 1.2rem">Quốc Toàn</div>
                        <div class="date-review">09/02/2023</div>
                    </div>
                    <div>
                        <div class="rating-star" style="font-size: 0.9rem; height: 1.8rem">
                            <span class="fas fa-star" style="color: #F6A500; font-weight: bold;"></span>
                            <span class="fas fa-star" style="color: #F6A500; font-weight: bold;"></span>
                            <span class="fas fa-star" style="color: #F6A500; font-weight: bold;"></span>
                            <span class="fas fa-star" style="color: #F6A500; font-weight: bold;"></span>
                            <span class="fas fa-star" style="color: #F6A500; font-weight: bold;"></span>
                        </div>
                        <div class="user-comment">
                            Truyện hay. Giao hàng nhanh. Cho 5 sao.
                        </div>
                    </div>
                </div>
                <div class="col-12 d-flex rounded px-3 py-3 align-items-center mt-2" style="background-color: rgba(30, 144, 255, 0.1)">
                    <div class="user-image">TV</div>
                    <div class="user-information-review ms-3">
                        <div class="user-name" style="font-size: 1.2rem">Thoại Vỹ</div>
                        <div class="date-review">08/02/2023</div>
                    </div>
                    <div>
                        <div class="rating-star" style="font-size: 0.9rem; height: 1.8rem">
                            <span class="fas fa-star" style="color: #F6A500; font-weight: bold;"></span>
                            <span class="fas fa-star" style="color: #F6A500; font-weight: bold;"></span>
                            <span class="fas fa-star" style="color: #F6A500; font-weight: bold;"></span>
                            <span class="fas fa-star" style="color: #F6A500; font-weight: bold;"></span>
                            <span class="fas fa-star"></span>
                        </div>
                        <div class="user-comment">
                            Truyện cũng hay. Shop đóng gói cẩn thận. Cho 4 sao.
                        </div>
                    </div>
                </div>*@
            </div>
        </div>
        <div class="col-1"></div>
    </div>
</div>
