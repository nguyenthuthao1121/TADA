@page
@model BookManagementModel
@{
    ViewData["Title"] = "Quản lý sách";
    Layout = "~/Pages/Shared/_LayoutAdmin.cshtml";
    ViewBag.Name = HttpContext.Session.GetString("Name");
}
@{
    var datapaging = new
    {
        currentPage = Model.currentPage,
        countPages = Model.countPages,
        category = Model.CategoryId,
        provider = Model.ProviderId,
        sortBy = Model.SortBy,
        sortType = Model.SortType,
        q = Model.q,
        inStock = Model.InStock
    };
}
<div class="row">
    <div class="col-10 m-0 p-0 content">
        <div class="feature">
            <div class="feature-item filter-search">
                <div class="filter-search-feature filter-search-container">
                    <div class="filter">
                        <span class="filter-search-heading" style="margin-right: 8px">Lọc theo :</span>
                        <div class="filter-feature">                          
                            <form method="get">
                                <input type="hidden" name="q" value="@Model.q" />
                                <select class="select-filter filter-feature-item" asp-for="ProviderId">
                                    <option value="0">Nhà cung cấp: Tất cả</option>
                                    @foreach (var provider in Model.Providers)
                                    {
                                        <option value="@provider.Id">@provider.Name</option>
                                    }
                                </select>
                                <select class="select-filter filter-feature-item" asp-for="CategoryId">
                                    <option value="0">Danh mục: Tất cả</option>
                                    @foreach (var category in Model.Categories)
                                    {
                                        <option value="@category.Id">@category.Name</option>
                                    }
                                </select>
                                <select class="select-filter filter-feature-item" asp-for="InStock">
                                    <option value="0">Trạng thái: Tất cả</option>
                                    <option value="1">Còn hàng</option>
                                    <option value="2">Hết hàng</option>
                                </select>
                                <button class="feature-btn filter-feature-item" type="submit">
                                    Lọc
                                </button>
                            </form>
                        </div>
                    </div>
                    <div class="search-feature" style="margin-left: 0; margin-bottom: 4px">
                        <form method="get">
                            <input type="text" class="search-feature-input" asp-for="q" placeholder="Tìm kiếm sách">
                            <button class="feature-btn" type="submit">
                                <i class="search-feature-btn-icon fa-solid fa-magnifying-glass"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="feature-item sort">
                <span class="sort-heading">Sắp xếp theo :</span>
                <div class="sort-feature">
                    <div class="sort-feature-item">
                        <form method="get">
                            <input type="hidden" name="q" value="@Model.q" />
                            <input type="hidden" name="CategoryId" value="@Model.CategoryId" />
                            <input type="hidden" name="ProviderId" value="@Model.ProviderId" />
                            <input type="hidden" name="InStock" value="@Model.InStock" />

                            <select class="sort-by" asp-for="SortBy">
                                <option value="">Thuộc tính:</option>
                                <option value="book">Tên sách</option>
                                <option value="category">Danh mục</option>
                                <option value="status">Trạng thái</option>
                            </select>
                            <select class="sort-type" asp-for="SortType">
                                <option value="asc">Tăng dần</option>
                                <option value="desc">Giảm dần</option>
                            </select>
                            <button class="feature-btn" type="submit">
                                Sắp xếp
                            </button>
                        </form>
                    </div>
                </div>

            </div>
        </div>
        <div class="user-list-container book-container">
            <div class="user-table">
                <table class="table" style="width: 100%; color: var(--primary-color)">
                    <tr class="table-row list-row">
                        <th style="width: 4%">STT</th>
                        <th style="width: 30%">Tên sách</th>
                        <th style="width: 6%">Hình ảnh</th>
                        <th style="width: 10%">Tác giả</th>
                        <th style="width: 10%">Nhà xuất bản</th>
                        <th style="width: 10%">Nhà cung cấp</th>
                        <th style="width: 8%">Danh mục</th>
                        <th style="width: 10%">Đơn giá (VND)</th>
                        <th style="width: 7%">Trạng thái</th>
                        <th style="width: 5%">Chi tiết</th>
                    </tr>  
                    @{
                        int cnt = 0;
                        foreach(var book in Model.Books)
                        {
                            var imgPath = book.Image + "/cover.jpg";
                            <tr class="table-container" style="color: var(--text-color)">
                                <th class="table-value list-value">@(++cnt)</th>
                                <td class="table-value list-value" style="font-weight: 600">@book.Name</td>
                                <td class="table-value list-value">                                   
                                    <img class="book-img" img src="@Url.Content(imgPath)" alt="@book.Name">
                                </td>
                                <td class="table-value list-value">@book.Author</td>
                                <td class="table-value list-value">@book.Publisher</td>
                                <td class="table-value list-value">@book.Provider</td>
                                <td class="table-value list-value">@book.Category</td>
                                <td class="table-value list-value">@book.GetPriceString(book.GetCurrentPrice())</td>
                                @if (book.Quantity > 0)
                                {
                                    <td class="table-value list-value">Còn hàng</td>
                                }
                                else
                                {
                                    <td class="table-value list-value">Hết hàng</td>
                                }
                                <td class="table-value list-value">
                                    <ul class="btn-container">
                                        <li class="btn-item">
                                            <a asp-area="Book" asp-page="BookDetailAdmin" asp-route-id="@book.Id" class="action-admin-btn">
                                                <i class="view-icon fa-regular fa-eye"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </td>
                            </tr>                            
                        }
                    }
                </table>
            </div>
            <div class="pagination-container add-button book-button" style="margin-bottom: 4px">
                <div class="add-button">
                    <a asp-area="" asp-page="/Admin/AddBook">
                        <button class="feature-btn add-btn">
                            THÊM MỚI SÁCH
                        </button>
                    </a>
                </div>
                <partial name="_PagingAdmin" model="datapaging"/>
            </div>
        </div>

    </div>
    
</div>
